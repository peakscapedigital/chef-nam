---
// Short form component for homepage
---

<form id="home-contact-form" class="space-y-6 rounded-lg border border-brand-cream bg-brand-white p-6 shadow-sm">
  <div class="grid gap-4 sm:grid-cols-2">
    <div class="space-y-2">
      <label for="firstName" class="text-sm font-medium text-brand-indigo">First Name *</label>
      <input 
        id="firstName" 
        name="firstName" 
        type="text"
        placeholder="First name" 
        required 
        class="w-full px-4 py-3 border border-brand-cream rounded-lg focus:ring-2 focus:ring-brand-amber focus:border-brand-amber"
      />
    </div>
    <div class="space-y-2">
      <label for="lastName" class="text-sm font-medium text-brand-indigo">Last Name *</label>
      <input 
        id="lastName" 
        name="lastName"
        type="text" 
        placeholder="Last name" 
        required 
        class="w-full px-4 py-3 border border-brand-cream rounded-lg focus:ring-2 focus:ring-brand-amber focus:border-brand-amber"
      />
    </div>
  </div>
  
  <div class="grid gap-4 sm:grid-cols-2">
    <div class="space-y-2">
      <label for="email" class="text-sm font-medium text-brand-indigo">Email *</label>
      <input 
        id="email" 
        name="email"
        type="email" 
        placeholder="Your email address" 
        required 
        class="w-full px-4 py-3 border border-brand-cream rounded-lg focus:ring-2 focus:ring-brand-amber focus:border-brand-amber"
      />
    </div>
    <div class="space-y-2">
      <label for="phone" class="text-sm font-medium text-brand-indigo">Phone *</label>
      <input 
        id="phone" 
        name="phone"
        type="tel" 
        placeholder="Your phone number" 
        required 
        class="w-full px-4 py-3 border border-brand-cream rounded-lg focus:ring-2 focus:ring-brand-amber focus:border-brand-amber"
      />
    </div>
  </div>
  
  <div class="space-y-2">
    <label for="message" class="text-sm font-medium text-brand-indigo">Tell us about your event</label>
    <textarea 
      id="message" 
      name="message"
      placeholder="Share details about your event, guest count, preferences, or any questions..."
      rows="4"
      class="w-full px-4 py-3 border border-brand-cream rounded-lg focus:ring-2 focus:ring-brand-amber focus:border-brand-amber"
    ></textarea>
  </div>
  
  <button 
    type="submit"
    class="w-full bg-brand-amber text-white font-semibold py-4 px-6 rounded-lg hover:bg-brand-amber/90 transition-colors"
  >
    Get My Custom Proposal
  </button>
  <p class="text-brand-indigo/60 text-sm text-center">
    Response within 24 hours • Free consultation • No obligations
  </p>
</form>

<script>
// Short form submission for homepage
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('home-contact-form');
  
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const message = document.getElementById('message').value;
      
      // Validate required fields
      if (!firstName || !lastName || !email || !phone) {
        alert('Please fill in all required fields');
        return;
      }
      
      const submitButton = form.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.textContent = 'Sending...';
      submitButton.disabled = true;
      
      try {
        // Get attribution data from localStorage (captured on landing)
        const attribution = {
          utm_source: localStorage.getItem('utm_source') || undefined,
          utm_medium: localStorage.getItem('utm_medium') || undefined,
          utm_campaign: localStorage.getItem('utm_campaign') || undefined,
          utm_term: localStorage.getItem('utm_term') || undefined,
          utm_content: localStorage.getItem('utm_content') || undefined,
          gclid: localStorage.getItem('gclid') || undefined,
          fbclid: localStorage.getItem('fbclid') || undefined,
          lead_source: localStorage.getItem('lead_source') || 'Direct',
          referrer: localStorage.getItem('referrer') || undefined,
          landing_page: localStorage.getItem('landing_page') || undefined
        };

        // Clean undefined values
        Object.keys(attribution).forEach(key => {
          if (attribution[key] === undefined) delete attribution[key];
        });

        // Submit to API
        const response = await fetch('/api/submit-form', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            firstName: firstName,
            lastName: lastName,
            email: email,
            phone: phone,
            message: message,
            source: 'homepage',
            submitted_from_url: window.location.href,
            ...attribution
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Redirect to planning form with pre-populated data
          const params = new URLSearchParams({
            firstName: firstName,
            lastName: lastName,
            email: email,
            phone: phone,
            message: message,
            source: 'homepage',
            submissionId: result.id // Pass the ID so we can update this submission
          });
          
          window.location.href = `/start-planning?${params.toString()}`;
        } else {
          throw new Error(result.message || 'Failed to submit form');
        }
      } catch (error) {
        console.error('Error submitting form:', error);
        alert('Sorry, there was an error. Please try again or contact us directly.');
        submitButton.textContent = originalText;
        submitButton.disabled = false;
      }
    });
  }
});
</script>